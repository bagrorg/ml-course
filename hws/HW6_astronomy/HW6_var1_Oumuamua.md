**Задача 1**: Обработка наблюдений межвёздного объекта 1I/'Oumuamua, пролетевшего по нашей Солнечной системе в 2017-2018 гг. Наблюдений всего 222. Точнее, 444 (в каждом из 222 по две наблюдаемые величины). Нужно определить 6 параметров орбиты, с которыми значение wrms (weighted root-mean-square) разностей между модельными и реальными наблюдениями минимально. 

Дополнительное задание для интересующихся: заметить в остаточных разностях систематическую погрешность, говорящую о негравитационном ускорении объекта, и определить величину этого ускорения. Некоторые астрономы [объясняют](https://www.hmhbooks.com/shop/books/Extraterrestrial/9780358274551) это ускорение тем, что 1I/'Oumuamua — дело рук инопланетян, но есть и другие мнения.

**Методика решения**: Построить начальную орбиту объекта методом численного интегрирования с произвольно взятыми (например, из JPL HORIZONS, см. ниже) начальными параметрами: положением и скоростью объекта на дату первого наблюдения, т. е. 14.10.2017. По рассчитанной орбите вычислить модельные значения наблюдаемых величин. Вычислить их разности с реальными наблюдениями и производные от этих разностей по шести параметрам орбиты. Применить нелинейный взвешенный МНК (см. материалы лекций [[1]](https://docs.google.com/presentation/d/1B0DPayB2IO--sBSsRjsDlBwbyayBOJDYEPNEQHfGDWI/edit), [[2]](https://docs.google.com/presentation/d/12eQt2S2nw-t_IYpp8OAPOmbWps6GzbgKQNbyFwoGNJM/edit)) и рассчитать поправки к начальным параметрам. Повторять до тех пор, пока результат не перестанет существенно меняться.

В работе потребуется интерполировать положения объектов в декартовых координатах, заданных на равномерной сетке времени. Например, положения Земли и Солнца, которые доступны например [здесь](http://iaaras.ru/dept/ephemeris/online/) (опции: по отношению к барицентру Солнечной системы, шкала TDB, выключить поправку за световой промежуток, выходные данные переключить на X Y Z). Аналогичное средство есть в службе [JPL HORIZONS](https://ssd.jpl.nasa.gov/horizons.cgi). В любом случае, нужно будет научиться быстро обращаться к этим данным, интерполируя их на произвольный момент времени.

Нужно будет научиться вычислять модельные значения наблюдаемых величин. Наблюдаемыми величинами являются прямое восхождение (right ascension) и склонение (declination). Это сферические координаты на небесной сфере.

Как вычислить эти величины, зная геоцентрическое положение наблюдателя и момент времени наблюдения? Очень просто. Нужно вычислить положение наблюдателя в момент наблюдения, положение объекта в момент, запаздывающий по сравнению с моментом наблюдения на время хода луча и вычесть положение наблюдателя из положения объекта. Получится вектор (направление), который нужно поправить на гравитационное отклонение света Солнцем и аберрацию, возникающую из-за движения наблюдателя, после чего перевести в сферические координаты.

Следует помнить о шкалах времени. Наблюдения изначально приведены в шкале UTC. Небесные объекты существуют в шкале TDB и в системе координат, связанной с барицентром Солнечной системы. Конверсия обычно делается ступенчато через ещё две другие шкалы: TDB <-> TT <-> TAI <-> UTC, см. ниже.

Наблюдения объекта даны на сайте [Центра малых планет](https://minorplanetcenter.net/db_search/show_object?object_id=1I). Других наблюдений нет и не будет, объект покинул Солнечную систему навсегда. Наблюдения сделаны в разные моменты времени в разных обсерваториях. [Перечень наземных обсерваторий](https://www.minorplanetcenter.net/iau/lists/ObsCodesF.html) в цилиндрических координатах (λ, r, z). Две последние величины даны в экваториальных радиусах Земли (6378.140 км).

Часть наблюдений сделана космическим телескопом «Хаббл», координаты которого можно получить через службу [JPL HORIZONS](https://ssd.jpl.nasa.gov/horizons.cgi) со следующими настройками:

 * Ephemeris Type [change]: **VECTORS**
 * Target Body [change]: **Hubble Space Telescope (HST (spacecraft))** [-48]
 * Coordinate Origin [change]: **Geocentric** [500]
 * Time Span [change]: Start=**2017-10-14**, Stop=**2018-01-03**, Step=**1 m**
 * Table Settings [change]: output units=**KM-S**; reference plane=**FRAME**
 * Display/Output [change]: default (formatted HTML)

Реализации некоторых астрономических вещей можно позаимствовать из библиотеки [IAU SOFA](https://www.iausofa.org/) или какой-то аналогичной. Ниже приведён порядок вычисления модельных значений прямого восхождения и склонения с указанием функций SOFA.

 * Вычисление декартовых координат обсерватории из заданных цилиндрических: самостоятельно
 * Конверсия шкал времени: TT - TDB см. например [здесь](http://iaaras.ru/dept/ephemeris/online/) (объект TT - TDB), TT = TAI + 32.184 с, TAI - UTC см. iauDat.
 * Перевод координат обсерватории из земных в геоцентрические небесные: iauC2t06a
 * Интерполяция координат центра Земли и вычисление координат обсерватории в инерциальной системе: самостоятельно
 * Численное интегрирование траектории объекта, сохранение на равномерной сетке времени, интерполяция на сетке: самостоятельно
 * Поправка за световой промежуток (light time correction): самостоятельно решить относительно delta уравнение вида |object(t - delta) - observer(t)| = c * delta, где c — скорость света, а t — время наблюдения
 * Гравитационное отклонение света Солнцам: iauLd
 * Аберрация света: iauAb
 * Преобразование декартовых координат к сферическим: iauC2s

Для того чтобы рассчитать орбиту, нужно численно решить задачу Коши следующего вида:

 * X(t) = (x, y, z, vx, vy, vz)
 * X(0) = (x0, y0, z0, vx0, vy0, vz0)
 * dX/dt = (vx, vy, vz, ax, ay, az)

где (ax, ay, az) — гравитационное ускорение объекта под действием Солнца, Земли, Луны, Марса, Венеры, Меркурия, Юпитера и Сатурна. (Возможно, хватит только Солнца и Юпитера.) Положения возмущающих тел см. на вышеупомянутом сайте ИПА РАН или JPL HORIZONS. Гравитационные постоянные (GM) возмущающих тел можно взять например [тут](http://iaaras.ru/en/dept/ephemeris/epm/2017/#5). Ускорения считать по законам Ньютона.

Для численного интегрирования можно использовать например [метод Дормана-Принса](https://en.wikipedia.org/wiki/Dormand–Prince_method) 5-го порядка.

Производные от наблюдаемых величин по параметрам орбиты проще всего считать численно: инкрементировать параметр, проинтегрировать орбиту, вычислить модельные значения наблюдаемых величин с изменённой орбитой, вычесть из них те значения, которые были с исходной орбитой, и разделить на инкремент. Можно вместо этого использовать изохронные производные, но не обязательно.
